CREATE DATABASE esd_wine
    WITH
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'Portuguese_Portugal.1252'
    LC_CTYPE = 'Portuguese_Portugal.1252'
    LOCALE_PROVIDER = 'libc'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1
    IS_TEMPLATE = False







DROP TABLE IF EXISTS feeds_rss                          CASCADE;
DROP TABLE IF EXISTS feeds_rss_processada               CASCADE;
DROP TABLE IF EXISTS file_csv_comentario                CASCADE;
DROP TABLE IF EXISTS file_csv_comentario_processada     CASCADE;
DROP TABLE IF EXISTS loja                               CASCADE;
DROP TABLE IF EXISTS metodo_pagamento                   CASCADE;
DROP TABLE IF EXISTS produto                            CASCADE;
DROP TABLE IF EXISTS sentimento                         CASCADE;
DROP TABLE IF EXISTS utilizador                         CASCADE;
DROP TABLE IF EXISTS utilizador_email                   CASCADE;
DROP TABLE IF EXISTS venda                              CASCADE;
DROP TABLE IF EXISTS venda_processada                   CASCADE;
DROP TABLE IF EXISTS website_feedback                   CASCADE;
DROP TABLE IF EXISTS website_feedback_processada        CASCADE;

-- FEEDS
CREATE TABLE feeds_rss (
    id                      SERIAL PRIMARY KEY,
    fonte_nome              TEXT,
    fonte_url               TEXT,
    idioma                  TEXT,
    titulo                  TEXT,
    link                    TEXT,
    sumario                 TEXT,
    datahora                TIMESTAMP WITHOUT TIME ZONE,    --- = data_publicacao
    extracted_on            TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    processed               BOOLEAN DEFAULT FALSE
);

CREATE TABLE feeds_rss_processada (
    id                      SERIAL PRIMARY KEY,
    r_id                    INTEGER,
    titulo                  TEXT,
    sumario                 TEXT,
    processed_on            TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    applied_tas             BOOLEAN DEFAULT FALSE
);

-- COMENTÁRIOS (CSV)
CREATE TABLE file_csv_comentarios (
    id                      SERIAL PRIMARY KEY,
    commentid               INTEGER,
    userid                  INTEGER,
    productid               INTEGER,
    storeid                 INTEGER,
    datahora                TIMESTAMP WITHOUT TIME ZONE,
    texto                   TEXT,
    extracted_on            TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    processed               BOOLEAN DEFAULT FALSE
);

CREATE TABLE file_csv_comentarios_processada (
    id                      SERIAL PRIMARY KEY,
    r_id                    INTEGER,
    texto                   TEXT,
    processed_on            TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    applied_tas             BOOLEAN DEFAULT FALSE
);

-- WEBSITE FEEDBACK
CREATE TABLE website_feedback (
    id                      SERIAL PRIMARY KEY,
    object_id               TEXT,
    email                   TEXT,
    comentarios             TEXT,
    classificacao           INTEGER,
    datahora                TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,      --- = ingested_on
    source                  TEXT DEFAULT 'website feedback',
    extracted               BOOLEAN DEFAULT FALSE
);

INSERT INTO website_feedback (object_id, email, comentarios, classificacao, source) VALUES
  ('object id no. 00001','ccj.gmr@gmail.com', 'Adoro vinho do Porto!', '7', 'website feedback'),
  ('object id no. 00002','rmmmrodrigues@gmail.com', 'Fraca experiência com Mateus Rosé', '2', 'website feedback'),
  ('object id no. 00003','filipapereira306@gmail.com', 'Que maravilho Moet Chandon vinho do Porto!', '10', 'website feedback'),
  ('object id no. 00004','ccj.gmr@gmail.com', 'Desgostoso com o vinho alentejano', '1', 'website feedback'),
  ('object id no. 00005','diegojeffersonms@gmail.com', 'Inacreditável! Um verdedeiro elixir!!!', '10', 'website feedback');

CREATE TABLE website_feedback_processada (
    id                      SERIAL PRIMARY KEY,
    r_id                    INTEGER,
    comentarios             TEXT,
    processed_on            TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    applied_tas             BOOLEAN DEFAULT FALSE
);

-- LOJA
CREATE TABLE loja (
    loja_id          SERIAL PRIMARY KEY,
    loja             TEXT
);

INSERT INTO loja (loja_id, loja) VALUES
 (1,'Loja on-line'),
 (2,'Loja Braga');

-- METODO_PAGAMENTO
CREATE TABLE metodo_pagamento
(
    metodo_pagamento_id     SERIAL PRIMARY KEY,
    metodo_pagamento        TEXT
);

INSERT INTO metodo_pagamento (metodo_pagamento_id, metodo_pagamento) VALUES
  (1,'MULTIBANCO'),
  (2,'TANSFERÊNCIA BANCÁRIA'),
  (3,'CARTÃO DÉBITO'),
  (4,'CARTÃO CRÉDITO');

-- PRODUTO
CREATE TABLE produto (
    produto_id              SERIAL PRIMARY KEY,
    produto                 TEXT,
    regiao                  TEXT,
    safra                   TEXT
);

-- UTILIZADOR
CREATE TABLE utilizador (
    utilizador_id           SERIAL PRIMARY KEY,
    nome                    TEXT,
    email                   TEXT,
    data_nascimento         TIMESTAMP WITHOUT TIME ZONE,
    genero                  TEXT,
    regiao                  TEXT
);

INSERT INTO utilizador (nome, email) VALUES
  ('Carlos','ccj.gmr@gmail.com'),
  ('Rui','rmmmrodrigues@gmail.com'),
  ('Filipa','filipapereira306@gmail.com'),
  ('Diego','diegojeffersonms@gmail.com');

-- UTILIZADOR_EMAIL
CREATE TABLE utilizador_email (
    utilizador_id           INTEGER,
    email                   TEXT,
    created_on              TIMESTAMP WITHOUT TIME ZONE
);

INSERT INTO utilizador_email (utilizador_id, email) VALUES
  (1,'carlos@gmail.com'),
  (2,'rmmmrodrigues@gmail.com'),
  (3,'filipapereira306@gmail.com'),
  (4,'diegojeffersonms@gmail.com'),
  (1,'ccj.gmr@gmail.com');

-- SENTIMENTO
CREATE TABLE sentimento (
    sentimento_id           SERIAL PRIMARY KEY,
    utilizador_id           INTEGER,
    text                    TEXT,       --- corresponde ao texto que foi tratado
    datahora                TIMESTAMP WITHOUT TIME ZONE,
    modelo                  TEXT,       --- corresponde ao modelo com que foi tratado o texto para gerar o sentimento/score
    sentimento              TEXT,
    score                   DOUBLE PRECISION,
    created_on              TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT utilizador_fkey FOREIGN KEY (utilizador_id)
        REFERENCES utilizador (utilizador_id) MATCH SIMPLE
);

-- VENDA
CREATE TABLE venda (
    venda_id                SERIAL PRIMARY KEY,
    utilizador_id           INTEGER,
    datahora                TIMESTAMP WITHOUT TIME ZONE,
    loja_id                 INTEGER,
    produto_id              INTEGER,
    quantidade              INTEGER,
    valor_unitario          DOUBLE PRECISION,
    metodo_pagamento_id     INTEGER,
    comentario              TEXT,
    extracted               BOOLEAN DEFAULT FALSE,        
    CONSTRAINT utilizador_fkey FOREIGN KEY (utilizador_id)
        REFERENCES utilizador (utilizador_id) MATCH SIMPLE,
    CONSTRAINT loja_fkey FOREIGN KEY (loja_id)
        REFERENCES loja (loja_id) MATCH SIMPLE,
    CONSTRAINT produto_fkey FOREIGN KEY (produto_id)
        REFERENCES produto (produto_id) MATCH SIMPLE,
    CONSTRAINT metodo_pagamento_fkey FOREIGN KEY (metodo_pagamento_id)
        REFERENCES metodo_pagamento (metodo_pagamento_id) MATCH SIMPLE
);

-- VENDA_PROCESSADA
CREATE TABLE venda_processada (
    venda_processada_id     SERIAL PRIMARY KEY,
    venda_id                INTEGER,
    comentario              TEXT,
    processed_on            TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    applied_tas             BOOLEAN DEFAULT FALSE,
    CONSTRAINT venda_fkey FOREIGN KEY (venda_id)
        REFERENCES venda (venda_id) MATCH SIMPLE
);